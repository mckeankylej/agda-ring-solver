<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Polynomial.NormalForm.Definition</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--without-K</a> <a id="25" class="Pragma">--safe</a> <a id="32" class="Symbol">#-}</a>

<a id="37" class="Comment">-- Definitions for the types of a polynomial stored in sparse horner</a>
<a id="106" class="Comment">-- normal form.</a>
<a id="122" class="Comment">--</a>
<a id="125" class="Comment">-- These definitions ensure that the polynomial is actually in fully</a>
<a id="194" class="Comment">-- canonical form, with no trailing zeroes, etc.</a>

<a id="244" class="Keyword">open</a> <a id="249" class="Keyword">import</a> <a id="256" href="Polynomial.Parameters.html" class="Module">Polynomial.Parameters</a>

<a id="279" class="Keyword">module</a> <a id="286" href="Polynomial.NormalForm.Definition.html" class="Module">Polynomial.NormalForm.Definition</a>
  <a id="321" class="Symbol">{</a><a id="322" href="Polynomial.NormalForm.Definition.html#322" class="Bound">a</a><a id="323" class="Symbol">}</a>
  <a id="327" class="Symbol">(</a><a id="328" href="Polynomial.NormalForm.Definition.html#328" class="Bound">coeffs</a> <a id="335" class="Symbol">:</a> <a id="337" href="Polynomial.Parameters.html#562" class="Record">RawCoeff</a> <a id="346" href="Polynomial.NormalForm.Definition.html#322" class="Bound">a</a><a id="347" class="Symbol">)</a>
  <a id="351" class="Keyword">where</a>

<a id="358" class="Keyword">open</a> <a id="363" class="Keyword">import</a> <a id="370" href="Polynomial.NormalForm.InjectionIndex.html" class="Module">Polynomial.NormalForm.InjectionIndex</a>

<a id="408" class="Keyword">open</a> <a id="413" class="Keyword">import</a> <a id="420" href="Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="437" class="Keyword">using</a> <a id="443" class="Symbol">(</a><a id="444" href="Relation.Nullary.html#500" class="Function Operator">¬_</a><a id="446" class="Symbol">)</a>
<a id="448" class="Keyword">open</a> <a id="453" class="Keyword">import</a> <a id="460" href="Level.html" class="Module">Level</a>            <a id="477" class="Keyword">using</a> <a id="483" class="Symbol">(</a><a id="484" href="Agda.Primitive.html#657" class="Primitive Operator">_⊔_</a><a id="487" class="Symbol">)</a>
<a id="489" class="Keyword">open</a> <a id="494" class="Keyword">import</a> <a id="501" href="Data.Empty.html" class="Module">Data.Empty</a>       <a id="518" class="Keyword">using</a> <a id="524" class="Symbol">(</a><a id="525" href="Data.Empty.html#279" class="Datatype">⊥</a><a id="526" class="Symbol">)</a>
<a id="528" class="Keyword">open</a> <a id="533" class="Keyword">import</a> <a id="540" href="Data.Unit.html" class="Module">Data.Unit</a>        <a id="557" class="Keyword">using</a> <a id="563" class="Symbol">(</a><a id="564" href="Agda.Builtin.Unit.html#137" class="Record">⊤</a><a id="565" class="Symbol">)</a>
<a id="567" class="Keyword">open</a> <a id="572" class="Keyword">import</a> <a id="579" href="Data.Nat.html" class="Module">Data.Nat</a>         <a id="596" class="Keyword">using</a> <a id="602" class="Symbol">(</a><a id="603" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="604" class="Symbol">;</a> <a id="606" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a><a id="609" class="Symbol">;</a> <a id="611" href="Agda.Builtin.Nat.html#183" class="InductiveConstructor">zero</a><a id="615" class="Symbol">)</a>
<a id="617" class="Keyword">open</a> <a id="622" class="Keyword">import</a> <a id="629" href="Data.Bool.html" class="Module">Data.Bool</a>        <a id="646" class="Keyword">using</a> <a id="652" class="Symbol">(</a><a id="653" href="Data.Bool.Base.html#1240" class="Function">T</a><a id="654" class="Symbol">)</a>
<a id="656" class="Keyword">open</a> <a id="661" class="Keyword">import</a> <a id="668" href="Data.List.Kleene.html" class="Module">Data.List.Kleene</a> <a id="685" class="Keyword">public</a>

<a id="693" class="Keyword">infixl</a> <a id="700" class="Number">6</a> <a id="702" href="Polynomial.NormalForm.Definition.html#776" class="InductiveConstructor Operator">_Δ_</a>
<a id="706" class="Keyword">record</a> <a id="PowInd"></a><a id="713" href="Polynomial.NormalForm.Definition.html#713" class="Record">PowInd</a> <a id="720" class="Symbol">{</a><a id="721" href="Polynomial.NormalForm.Definition.html#721" class="Bound">c</a><a id="722" class="Symbol">}</a> <a id="724" class="Symbol">(</a><a id="725" href="Polynomial.NormalForm.Definition.html#725" class="Bound">C</a> <a id="727" class="Symbol">:</a> <a id="729" class="PrimitiveType">Set</a> <a id="733" href="Polynomial.NormalForm.Definition.html#721" class="Bound">c</a><a id="734" class="Symbol">)</a> <a id="736" class="Symbol">:</a> <a id="738" class="PrimitiveType">Set</a> <a id="742" href="Polynomial.NormalForm.Definition.html#721" class="Bound">c</a> <a id="744" class="Keyword">where</a>
  <a id="752" class="Keyword">inductive</a>
  <a id="764" class="Keyword">constructor</a> <a id="PowInd._Δ_"></a><a id="776" href="Polynomial.NormalForm.Definition.html#776" class="InductiveConstructor Operator">_Δ_</a>
  <a id="782" class="Keyword">field</a>
    <a id="PowInd.coeff"></a><a id="792" href="Polynomial.NormalForm.Definition.html#792" class="Field">coeff</a> <a id="798" class="Symbol">:</a> <a id="800" href="Polynomial.NormalForm.Definition.html#725" class="Bound">C</a>
    <a id="PowInd.pow"></a><a id="806" href="Polynomial.NormalForm.Definition.html#806" class="Field">pow</a>   <a id="812" class="Symbol">:</a> <a id="814" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a>
<a id="816" class="Keyword">open</a> <a id="821" href="Polynomial.NormalForm.Definition.html#713" class="Module">PowInd</a> <a id="828" class="Keyword">public</a>

<a id="836" class="Keyword">open</a> <a id="841" href="Polynomial.Parameters.html#562" class="Module">RawCoeff</a> <a id="850" href="Polynomial.NormalForm.Definition.html#328" class="Bound">coeffs</a>

<a id="858" class="Keyword">mutual</a>
  <a id="867" class="Comment">-- A Polynomial is indexed by the number of variables it contains.</a>
  <a id="936" class="Keyword">infixl</a> <a id="943" class="Number">6</a> <a id="945" href="Polynomial.NormalForm.Definition.html#1015" class="InductiveConstructor Operator">_Π_</a>
  <a id="951" class="Keyword">record</a> <a id="Poly"></a><a id="958" href="Polynomial.NormalForm.Definition.html#958" class="Record">Poly</a> <a id="963" class="Symbol">(</a><a id="964" href="Polynomial.NormalForm.Definition.html#964" class="Bound">n</a> <a id="966" class="Symbol">:</a> <a id="968" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="969" class="Symbol">)</a> <a id="971" class="Symbol">:</a> <a id="973" class="PrimitiveType">Set</a> <a id="977" href="Polynomial.NormalForm.Definition.html#322" class="Bound">a</a> <a id="979" class="Keyword">where</a>
    <a id="989" class="Keyword">inductive</a>
    <a id="1003" class="Keyword">constructor</a> <a id="Poly._Π_"></a><a id="1015" href="Polynomial.NormalForm.Definition.html#1015" class="InductiveConstructor Operator">_Π_</a>
    <a id="1023" class="Keyword">field</a>
      <a id="1035" class="Symbol">{</a><a id="Poly.i"></a><a id="1036" href="Polynomial.NormalForm.Definition.html#1036" class="Field">i</a><a id="1037" class="Symbol">}</a>  <a id="1040" class="Symbol">:</a> <a id="1042" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a>
      <a id="Poly.flat"></a><a id="1050" href="Polynomial.NormalForm.Definition.html#1050" class="Field">flat</a> <a id="1055" class="Symbol">:</a> <a id="1057" href="Polynomial.NormalForm.Definition.html#1096" class="Datatype">FlatPoly</a> <a id="1066" href="Polynomial.NormalForm.Definition.html#1036" class="Field">i</a>
      <a id="Poly.i≤n"></a><a id="1074" href="Polynomial.NormalForm.Definition.html#1074" class="Field">i≤n</a>  <a id="1079" class="Symbol">:</a> <a id="1081" href="Polynomial.NormalForm.Definition.html#1036" class="Field">i</a> <a id="1083" href="Data.Nat.Base.html#2460" class="Datatype Operator">≤′</a> <a id="1086" href="Polynomial.NormalForm.Definition.html#964" class="Bound">n</a>

  <a id="1091" class="Keyword">data</a> <a id="FlatPoly"></a><a id="1096" href="Polynomial.NormalForm.Definition.html#1096" class="Datatype">FlatPoly</a> <a id="1105" class="Symbol">:</a> <a id="1107" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="1109" class="Symbol">→</a> <a id="1111" class="PrimitiveType">Set</a> <a id="1115" href="Polynomial.NormalForm.Definition.html#322" class="Bound">a</a> <a id="1117" class="Keyword">where</a>
    <a id="FlatPoly.Κ"></a><a id="1127" href="Polynomial.NormalForm.Definition.html#1127" class="InductiveConstructor">Κ</a> <a id="1129" class="Symbol">:</a> <a id="1131" href="Algebra.html#13977" class="Function">Carrier</a> <a id="1139" class="Symbol">→</a> <a id="1141" href="Polynomial.NormalForm.Definition.html#1096" class="Datatype">FlatPoly</a> <a id="1150" href="Agda.Builtin.Nat.html#183" class="InductiveConstructor">zero</a>
    <a id="FlatPoly.Σ"></a><a id="1159" href="Polynomial.NormalForm.Definition.html#1159" class="InductiveConstructor">Σ</a> <a id="1161" class="Symbol">:</a> <a id="1163" class="Symbol">∀</a> <a id="1165" class="Symbol">{</a><a id="1166" href="Polynomial.NormalForm.Definition.html#1166" class="Bound">n</a><a id="1167" class="Symbol">}</a> <a id="1169" class="Symbol">→</a> <a id="1171" class="Symbol">(</a><a id="1172" href="Polynomial.NormalForm.Definition.html#1172" class="Bound">xs</a> <a id="1175" class="Symbol">:</a> <a id="1177" href="Polynomial.NormalForm.Definition.html#1658" class="Function">Coeff</a> <a id="1183" href="Polynomial.NormalForm.Definition.html#1166" class="Bound">n</a> <a id="1185" href="Data.List.Kleene.html#269" class="Record Operator">⁺</a><a id="1186" class="Symbol">)</a> <a id="1188" class="Symbol">→</a> <a id="1190" class="Symbol">.{</a><a id="1192" href="Polynomial.NormalForm.Definition.html#1192" class="Bound">xn</a> <a id="1195" class="Symbol">:</a> <a id="1197" href="Polynomial.NormalForm.Definition.html#2378" class="Function">Norm</a> <a id="1202" href="Polynomial.NormalForm.Definition.html#1172" class="Bound">xs</a><a id="1204" class="Symbol">}</a> <a id="1206" class="Symbol">→</a> <a id="1208" href="Polynomial.NormalForm.Definition.html#1096" class="Datatype">FlatPoly</a> <a id="1217" class="Symbol">(</a><a id="1218" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="1222" href="Polynomial.NormalForm.Definition.html#1166" class="Bound">n</a><a id="1223" class="Symbol">)</a>

  <a id="1228" class="Comment">-- A list of coefficients, paired with the exponent *gap* from the</a>
  <a id="1297" class="Comment">-- preceding coefficient. In other words, to represent the</a>
  <a id="1358" class="Comment">-- polynomial:</a>
  <a id="1375" class="Comment">--</a>
  <a id="1380" class="Comment">--   3 + 2x² + 4x⁵ + 2x⁷</a>
  <a id="1407" class="Comment">--</a>
  <a id="1412" class="Comment">-- We write:</a>
  <a id="1427" class="Comment">--</a>
  <a id="1432" class="Comment">--   [(3,0),(2,1),(4,2),(2,1)]</a>
  <a id="1465" class="Comment">--</a>
  <a id="1470" class="Comment">-- Which can be thought of as a representation of the expression:</a>
  <a id="1538" class="Comment">--</a>
  <a id="1543" class="Comment">--   x⁰ * (3 + x * x¹ * (2 + x * x² * (4 + x * x¹ * (2 + x * 0))))</a>
  <a id="1612" class="Comment">--</a>
  <a id="1617" class="Comment">-- This is sparse Horner normal form.</a>

  <a id="Coeff"></a><a id="1658" href="Polynomial.NormalForm.Definition.html#1658" class="Function">Coeff</a> <a id="1664" class="Symbol">:</a> <a id="1666" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="1668" class="Symbol">→</a> <a id="1670" class="PrimitiveType">Set</a> <a id="1674" href="Polynomial.NormalForm.Definition.html#322" class="Bound">a</a>
  <a id="1678" href="Polynomial.NormalForm.Definition.html#1658" class="Function">Coeff</a> <a id="1684" href="Polynomial.NormalForm.Definition.html#1684" class="Bound">n</a> <a id="1686" class="Symbol">=</a> <a id="1688" href="Polynomial.NormalForm.Definition.html#713" class="Record">PowInd</a> <a id="1695" class="Symbol">(</a><a id="1696" href="Polynomial.NormalForm.Definition.html#1871" class="Record">NonZero</a> <a id="1704" href="Polynomial.NormalForm.Definition.html#1684" class="Bound">n</a><a id="1705" class="Symbol">)</a>

  <a id="1710" class="Comment">-- We disallow zeroes in the coefficient list. This condition alone</a>
  <a id="1780" class="Comment">-- is enough to ensure a unique representation for any polynomial.</a>
  <a id="1849" class="Keyword">infixl</a> <a id="1856" class="Number">6</a> <a id="1858" href="Polynomial.NormalForm.Definition.html#1931" class="InductiveConstructor Operator">_≠0</a>
  <a id="1864" class="Keyword">record</a> <a id="NonZero"></a><a id="1871" href="Polynomial.NormalForm.Definition.html#1871" class="Record">NonZero</a> <a id="1879" class="Symbol">(</a><a id="1880" href="Polynomial.NormalForm.Definition.html#1880" class="Bound">i</a> <a id="1882" class="Symbol">:</a> <a id="1884" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="1885" class="Symbol">)</a> <a id="1887" class="Symbol">:</a> <a id="1889" class="PrimitiveType">Set</a> <a id="1893" href="Polynomial.NormalForm.Definition.html#322" class="Bound">a</a> <a id="1895" class="Keyword">where</a>
    <a id="1905" class="Keyword">inductive</a>
    <a id="1919" class="Keyword">constructor</a> <a id="NonZero._≠0"></a><a id="1931" href="Polynomial.NormalForm.Definition.html#1931" class="InductiveConstructor Operator">_≠0</a>
    <a id="1939" class="Keyword">field</a>
      <a id="NonZero.poly"></a><a id="1951" href="Polynomial.NormalForm.Definition.html#1951" class="Field">poly</a> <a id="1956" class="Symbol">:</a> <a id="1958" href="Polynomial.NormalForm.Definition.html#958" class="Record">Poly</a> <a id="1963" href="Polynomial.NormalForm.Definition.html#1880" class="Bound">i</a>
      <a id="1971" class="Symbol">.{</a><a id="NonZero.poly≠0"></a><a id="1973" href="Polynomial.NormalForm.Definition.html#1973" class="Field">poly≠0</a><a id="1979" class="Symbol">}</a> <a id="1981" class="Symbol">:</a> <a id="1983" href="Relation.Nullary.html#500" class="Function Operator">¬</a> <a id="1985" href="Polynomial.NormalForm.Definition.html#2120" class="Function">Zero</a> <a id="1990" href="Polynomial.NormalForm.Definition.html#1951" class="Field">poly</a>

  <a id="1998" class="Comment">-- This predicate is used (in its negation) to ensure that no</a>
  <a id="2062" class="Comment">-- coefficient is zero, preventing any trailing zeroes.</a>
  <a id="Zero"></a><a id="2120" href="Polynomial.NormalForm.Definition.html#2120" class="Function">Zero</a> <a id="2125" class="Symbol">:</a> <a id="2127" class="Symbol">∀</a> <a id="2129" class="Symbol">{</a><a id="2130" href="Polynomial.NormalForm.Definition.html#2130" class="Bound">n</a><a id="2131" class="Symbol">}</a> <a id="2133" class="Symbol">→</a> <a id="2135" href="Polynomial.NormalForm.Definition.html#958" class="Record">Poly</a> <a id="2140" href="Polynomial.NormalForm.Definition.html#2130" class="Bound">n</a> <a id="2142" class="Symbol">→</a> <a id="2144" class="PrimitiveType">Set</a>
  <a id="2150" href="Polynomial.NormalForm.Definition.html#2120" class="Function">Zero</a> <a id="2155" class="Symbol">(</a><a id="2156" href="Polynomial.NormalForm.Definition.html#1127" class="InductiveConstructor">Κ</a> <a id="2158" href="Polynomial.NormalForm.Definition.html#2158" class="Bound">x</a> <a id="2160" href="Polynomial.NormalForm.Definition.html#1015" class="InductiveConstructor Operator">Π</a> <a id="2162" class="Symbol">_)</a> <a id="2165" class="Symbol">=</a> <a id="2167" href="Data.Bool.Base.html#1240" class="Function">T</a> <a id="2169" class="Symbol">(</a><a id="2170" href="Polynomial.Parameters.html#629" class="Field">Zero-C</a> <a id="2177" href="Polynomial.NormalForm.Definition.html#2158" class="Bound">x</a><a id="2178" class="Symbol">)</a>
  <a id="2182" href="Polynomial.NormalForm.Definition.html#2120" class="Function">Zero</a> <a id="2187" class="Symbol">(</a><a id="2188" href="Polynomial.NormalForm.Definition.html#1159" class="InductiveConstructor">Σ</a> <a id="2190" class="Symbol">_</a> <a id="2192" href="Polynomial.NormalForm.Definition.html#1015" class="InductiveConstructor Operator">Π</a> <a id="2194" class="Symbol">_)</a> <a id="2197" class="Symbol">=</a> <a id="2199" href="Data.Empty.html#279" class="Datatype">⊥</a>

  <a id="2204" class="Comment">-- This predicate is used to ensure that all polynomials are in</a>
  <a id="2270" class="Comment">-- normal form: if a particular level is constant, than it can</a>
  <a id="2335" class="Comment">-- be collapsed into the level below it.</a>
  <a id="Norm"></a><a id="2378" href="Polynomial.NormalForm.Definition.html#2378" class="Function">Norm</a> <a id="2383" class="Symbol">:</a> <a id="2385" class="Symbol">∀</a> <a id="2387" class="Symbol">{</a><a id="2388" href="Polynomial.NormalForm.Definition.html#2388" class="Bound">i</a><a id="2389" class="Symbol">}</a> <a id="2391" class="Symbol">→</a> <a id="2393" href="Polynomial.NormalForm.Definition.html#1658" class="Function">Coeff</a> <a id="2399" href="Polynomial.NormalForm.Definition.html#2388" class="Bound">i</a> <a id="2401" href="Data.List.Kleene.html#269" class="Record Operator">⁺</a> <a id="2403" class="Symbol">→</a> <a id="2405" class="PrimitiveType">Set</a>
  <a id="2411" href="Polynomial.NormalForm.Definition.html#2378" class="Function">Norm</a> <a id="2416" class="Symbol">(_</a> <a id="2419" href="Polynomial.NormalForm.Definition.html#776" class="InductiveConstructor Operator">Δ</a> <a id="2421" href="Agda.Builtin.Nat.html#183" class="InductiveConstructor">zero</a>  <a id="2427" href="Data.List.Kleene.html#332" class="InductiveConstructor Operator">&amp;</a> <a id="2429" href="Data.List.Kleene.html#214" class="InductiveConstructor">[]</a><a id="2431" class="Symbol">)</a>    <a id="2436" class="Symbol">=</a> <a id="2438" href="Data.Empty.html#279" class="Datatype">⊥</a>
  <a id="2442" href="Polynomial.NormalForm.Definition.html#2378" class="Function">Norm</a> <a id="2447" class="Symbol">(_</a> <a id="2450" href="Polynomial.NormalForm.Definition.html#776" class="InductiveConstructor Operator">Δ</a> <a id="2452" href="Agda.Builtin.Nat.html#183" class="InductiveConstructor">zero</a>  <a id="2458" href="Data.List.Kleene.html#332" class="InductiveConstructor Operator">&amp;</a> <a id="2460" href="Data.List.Kleene.html#228" class="InductiveConstructor Operator">[</a> <a id="2462" class="Symbol">_</a> <a id="2464" href="Data.List.Kleene.html#228" class="InductiveConstructor Operator">]</a><a id="2465" class="Symbol">)</a> <a id="2467" class="Symbol">=</a> <a id="2469" href="Agda.Builtin.Unit.html#137" class="Record">⊤</a>
  <a id="2473" href="Polynomial.NormalForm.Definition.html#2378" class="Function">Norm</a> <a id="2478" class="Symbol">(_</a> <a id="2481" href="Polynomial.NormalForm.Definition.html#776" class="InductiveConstructor Operator">Δ</a> <a id="2483" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="2487" class="Symbol">_</a> <a id="2489" href="Data.List.Kleene.html#332" class="InductiveConstructor Operator">&amp;</a> <a id="2491" class="Symbol">_)</a>     <a id="2498" class="Symbol">=</a> <a id="2500" href="Agda.Builtin.Unit.html#137" class="Record">⊤</a>
<a id="2502" class="Keyword">open</a> <a id="2507" href="Polynomial.NormalForm.Definition.html#1871" class="Module">NonZero</a> <a id="2515" class="Keyword">public</a>
<a id="2522" class="Keyword">open</a> <a id="2527" href="Polynomial.NormalForm.Definition.html#958" class="Module">Poly</a> <a id="2532" class="Keyword">public</a>
</pre></body></html>